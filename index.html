<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Simple AR Heart for iOS</title>
    <!-- Include the AR.js and A-Frame libraries from CDN -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
            font-family: Arial, sans-serif;
        }
        
        .marker-guide {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            background-color: white;
            padding: 5px;
            border-radius: 5px;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .marker-guide img {
            max-width: 100%;
            max-height: 100%;
        }
        
        .instructions {
            position: fixed;
            top: 20px;
            left: 20px;
            max-width: 250px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="loading">
        <h2>Loading AR Experience</h2>
        <p>Please allow camera access when prompted</p>
        <p>If nothing happens after granting permissions, try refreshing the page</p>
    </div>
    
    <div class="instructions">
        <h3>AR Heart Instructions</h3>
        <p>Point your camera at the Hiro marker (shown in bottom right)</p>
        <p>The 3D heart will appear above the marker</p>
    </div>
    
    <div class="marker-guide">
        <img src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" alt="Hiro Marker">
    </div>
    
    <!-- A-Frame scene with AR.js -->
    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        renderer="logarithmicDepthBuffer: true;">
        
        <!-- Use a simple shape instead of OBJ model for better compatibility -->
        <a-marker preset="hiro">
            <a-entity
                position="0 1.5 0"
                rotation="0 0 0"
                scale="0.5 0.5 0.5">
                <!-- Use a simple heart shape with a red material -->
                <a-torus-knot
                    radius="0.8"
                    radius-tubular="0.4"
                    p="2"
                    q="3"
                    material="color: red; metalness: 0.5; roughness: 0.2;">
                    <a-animation
                        attribute="rotation"
                        dur="10000"
                        to="0 360 0"
                        repeat="indefinite"
                        easing="linear">
                    </a-animation>
                </a-torus-knot>
            </a-entity>
        </a-marker>
        
        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scene = document.querySelector('a-scene');
            const loading = document.getElementById('loading');
            
            // Hide loading screen when A-Frame scene is loaded
            scene.addEventListener('loaded', function() {
                loading.style.display = 'none';
            });
            
            // If camera isn't working after 10 seconds, show a message
            setTimeout(function() {
                if (loading.style.display !== 'none') {
                    loading.innerHTML = `
                        <h2>Camera Access Issue</h2>
                        <p>There might be a problem with camera access on your device.</p>
                        <p>Try these steps:</p>
                        <ol>
                            <li>Make sure Safari has camera access in Settings</li>
                            <li>Ensure you're using iOS 11 or later</li>
                            <li>Try opening this page in a new Safari tab</li>
                            <li>Make sure your page is served over HTTPS</li>
                        </ol>
                        <button onclick="window.location.reload()">Reload Page</button>
                    `;
                }
            }, 10000);
        });
    </script>
</body>
</html>
